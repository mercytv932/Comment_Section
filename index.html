<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Comment section</title>
</head>
<body>
  <div id="comment-form">
    <input type="text" placeholder="name" id="user" maxlength="50"> <br>
    <textarea name="user_comment" id="comment" placeholder="comment..." maxlength="500"></textarea> <br>
    <button class="submit">Submit</button>
    <div id="commentsDisplay"></div>

</div>

  <div>

    <h3>Latest comments</h3>
    <div id="latesComment"></div>

  </div>


  <script>
const user = document.querySelector("#user");
const comment = document.querySelector("#comment");
const submit = document.querySelector(".submit");
const commentsDisplay = document.querySelector("#commentsDisplay");

let comments = [];


//sanitize input/Esacpe function code
function escapeHtml(str){
  if(!str) return'';
  return str.replace(/</g, "&lt;"). replace(/>/g, "&gt;");
}


//comment code
function createCommentObject(name, commentText){
  const newComment = {
    id: Date.now().toString()+ Math.random().toString(36). substr(2,9),
    name: escapeHtml(name),
    comment: escapeHtml(commentText),
    timestamp: new Date().toISOString()
  };
  return newComment;
}


  //display a comment code
  function displayComment(CommentObj){
    
const newDiv = document.createElement("div");

const newHTag = document.createElement("h3");
newHTag.style.fontWeight = "bold";
newHTag.textContent = CommentObj.name;

const newPTag = document.createElement("p");
newPTag.textContent = CommentObj.comment;

const timeSpan = document.createElement("span");
timeSpan.textContent = new Date(CommentObj.timestamp).toLocaleString();

newDiv.appendChild(newHTag);
newDiv.appendChild(newPTag);
newDiv.appendChild(timeSpan);

commentsDisplay.appendChild(newDiv);
};


//delete commnet code
const deleteBtn = document.createElement("button");
deleteBtn.textContent = "Delete";
deleteBtn.style.cursor = "pointer";


//submit comment code
submit.addEventListener("click", function(event){
  event.preventDefault();

  const nameValue = user.value;
  const commentValue = comment.value;

  if(!nameValue || !commentValue) return; //don't submity empty blanks

  const newComment = createCommentObject(nameValue, commentValue);

  comments.push(newComment);
  localStorage.setItem('comments', JSON.stringify(comments));

  displayComment(newComment);

  user.value = "";
  comment.value = "";
});


//character length code
const userCounter = document.createElement("span");
userCounter.id = "userCounter";
user.after(CommentCounter);

const CommentCounter = document.createElement("span");
CommentCounter.id = "commentCounter";
comment.after(commentCounter);


user.addEventListener("input", function(){
  const count = user.value.length;
  const max = 50;
  userCounter.textContent = `${count}/${max};`;
});


//load comment code
function loadComments(){

  const comments = localStorage.getItem('comments');
  const comment = JSON.parse(comments);
  
  comment.forEach(c =>{
    console.log(c.comment);
  });

  comment.forEach(c =>{
    displayComment(c);
  })
}
loadComments();

  </script>
</body>
</html>
