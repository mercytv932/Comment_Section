<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Comment section</title>
</head>
<body>
  <div id="comment-form">
    <input type="text" placeholder="name" id="user"> <br>
    <textarea name="user_comment" id="comment" placeholder="comment..."></textarea> <br>
    <button class="submit">Submit</button>
    <div id="commentsDisplay"></div>

</div>

  <div>

    <h3>Latest comment</h3>
    <div id="latesComment"></div>

  </div>


  <script>
const user = document.querySelector("#user");
const comment = document.querySelector("#comment");
const submit = document.querySelector(".submit");
const commentsDisplay = document.querySelector("#commentsDisplay");


//comment code
function createCommentObject(name, commentText){
  const newComment = {
    id: Date.now().toString()+ Math.random().toString(36). substr(2,9),
    name: name,
    comment: commentText,

    timestamp: new Date().toISOString()

  };

  return newComment;
}

//submit comment code
submit.addEventListener("click", function(event){
  event.preventDefault();

  const nameValue = user.value;
  const commentValue = comment.value;

  const newComment = createCommentObject(nameValue, commentValue);
  console.log(newComment);
});

//display a comment code
const newDiv = document.querySelector("div");

const newHTag = document.querySelector("h3");
newHTag.style.fontWeight = "bold";
newHTag.innerText = "User Name";

const newPTag = document.querySelector("p");
newPTag.innerText = "This is the comment  text.";

const timeSpan = document.createElement("span");
timeSpan.innerText = new Date().toLocalString();

newDiv.appendChild(newHTag);
newDiv.appendChild(newPTag);
newDiv.appendChild(timeSpan);
commentsDisplay.appendChild(newDiv);


//sanitize input/Esacpe function code
function escapeHtml(str){
  if(!str) return'';
  return str.replace(/</g, "&lt;"). replace(/>/g, "&gt;");

  const userInput = "<script> alert ('xss') <script>";
  const userName = "<b> John </b>";

  const safeComment = escapeHTML(userInput);
  const safeName = escapeHTML(userName);
}


const comments = {
  id: Date.now(),
  text: commentText,
  author: authorName,
  timestamp: new Date().toISOString()
};

comments.push(newComment);
saveComments(comments);

function saveComments(commentsArray){
  const jsonComments = JSON.stringify(commentsArray);

  localStorage.setItem(COMMENTS_STORAGE_KEY, jsonComments);
}

  </script>
</body>
</html>
